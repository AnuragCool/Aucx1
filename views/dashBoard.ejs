<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Aucx</title>
     <!-- Bootstrap CSS -->
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
     <!-- Custom CSS -->
     <link rel="stylesheet" href="../css/style.css">
     <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
   <!-- Sweet Alert JavaScript -->
     <script src="/js/sweetalert2.js"></script>
     <script src="/js/utility.js"></script>
     <!-- Fontawesome CSS -->
     <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
     <!-- Nunito Google Font -->
     <link href="https://fonts.googleapis.com/css?family=Nunito:400,700" rel="stylesheet">
     <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-app.js"></script>
    <!-- Add additional services you want to use -->
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-functions.js"></script>
    <script src="https://kit.fontawesome.com/4062487ef9.js" crossorigin="anonymous"></script>
    <!-- <script src="https://kit.fontawesome.com/4062487ef9.js" crossorigin="anonymous"></script> -->

  


</head>
<body style="display: flex;">
        <div class="sidebar">
            <div class="option">
                <h2 style="pointer-events: none;color: white;text-align: center;margin-top: 1rem;">Aucx</h2>
                <ul class="option-list">
                    <li class="option-list-item">
                        <i class="fa-solid fa-rectangle-history"></i>
                        <a href="">&nbsp;Participated Auction</a>
                    </li>
                    <li class="option-list-item">
                        <i class="fa-solid fa-rectangle-history"></i>
                        <a href="">&nbsp;Home</a>
                    </li>
                    <li class="option-list-item">
                        <i class="fa-solid fa-rectangle-history"></i>
                        <a href="">&nbsp;Winner List</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="container" >
                
                <div style="display: grid;grid-template-columns:repeat(3,1fr);padding-top: 3rem;">
                <div class="search-bar">
                    <input type="text" id="search" placeholder="Search items">
                    <div class="search-btn">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                </div>
                <div class="tile text-center text-primary">
                    <h1 style="font-size: 4.5rem;margin: 0;padding: 0;display: inline-block;" class="h1">Aucx</h1>
                            <small style="color: black;margin: 0;padding: 0;">Best Place to Bid</small>
                </div>
                <div class="profile-container">
                <div class="profile"></div>
                <div id="profile-menu">
                    <a class="profile-menu-item" href="/profile">Profile</a>
                    <a class="profile-menu-item" href="/sessionLogout">Logout</a>
                  </div> 
                </div>
            </div>
            <div class="nav">
                <button id="defaultOpen" class="tablink" onclick="openPage('live-auctions', this)">Live Auction</button>
                <button class="tablink" onclick="openPage('upcoming-auctions', this)">Upcoming Auction</button>
                <button class="tablink" onclick="openPage('finished-auctions', this)">Finished Auction</button>
              </div>

                <div class="auction live-auctions">
                    
                    <h2>Live Auctions</h1>
                       
                        <div class="info center">
                            <div class="not-found"></div>
                            No auction found.
                        </div>
                    <ul class="auction-list">
                     
                    </ul>
                </div>

                <div class="auction upcoming-auctions">
                    <!-- <hr> -->
                    <h2>Upcoming Auctions</h1>
                       
                    <div class="info center">
                        <div class="not-found"></div>
                        No auction found.
                    </div>
                    <ul class="auction-list">
                        
                    </ul>
                </div>
    

                <div class="auction finished-auctions">
                    <!-- <hr> -->
                    <h2>Finished Auctions</h1>
                       
                        <div class="info center">
                            <div class="not-found"></div>
                            No auction found.
                        </div>
                    <ul class="auction-list">
                        </ul>
                </div>
            
           

        </div>
        
               
    
<script>
  // Initialize Firebase
  // TODO: Replace with your project's customized code snippet
   const firebaseConfig = {
  //place your firebaseConfig file Here
};
  firebase.initializeApp(firebaseConfig);
</script>
    <script>
        var toggle1 = 0 ;
        $(".profile").on("click",(e)=>{
            if(toggle1===0){
                toggle1=1;
                var x = e.target.offsetTop;
                var y = e.target.offsetWidth;
                $("#profile-menu").css({"display":"block","margin":"1rem"});
                setTimeout(()=>{
                    $("#profile-menu").css({"display":"none"});
                },3500)
            }else{
                toggle1=0;
                var x = e.target.offsetTop;
                var y = e.target.offsetWidth;
                $("#profile-menu").css({"display":"none"});
            }
            // $("#profile-menu").css("right",y);
            console.log(x,y);
        })
        var toggle = 0;
        $(".sidebar").on('click',()=>{
            if(toggle===0){
                toggle=1;
                $(".sidebar").css({
                    "width":"20%",
                    "top":"10px",
                    "left":"0",
                    "background-color":"#007BFF"
                });
                $(".option").css({
                    "display":"block"
                })

            }
            else{
                toggle=0;
                $(".sidebar").css({
                    "width":"40px",
                    "top":"10px",
                    "left":"0px",
                    "bottom":"10px",
                    "background-color":"#007BFF"
    
                });
                $(".option").css({
                    "display":"none"
                })
            }
        })
        var html="";
                    var htmlLive="";
                    var htmlEnd=" ";
        $.ajax({
            url:"/getAuctions",
            method:"POST",
            success:function(result,status,xhr){
                result.result.forEach(auction => {
                    var object = isLive(auction);
                    console.log(object);
                    if(object.isLive){
                       
                    html+=`
                    <li id=${auction.name} class="auction-list-item">
                        <a class="auction-link" href ="/auction/${auction.name}">
                            <div class="mycard">
                                <div class="mycard-title center">
                                    <h3 class="auction-title">${auction.name}</h3>
                                    <small class="time-remaining"><span id="${auction.name}hours"></span>:<span id="${auction.name}mins"></span>:<span id="${auction.name}secs"></span></small>
                                </div>
                                <div class="mycard-body">
                                        <div class="item-image-container">
                                            <div class="item-img" style='background: url("${auction.item.imageFront}");
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                /* background-color: rgb(240, 240, 240); */
                /* box-shadow: 0 0 1rem .05rem rgba(128, 128, 128, 0.137); */
                height: 125px;
                width: 125px;
                border-radius: 10px;
                border: 2px solid #5f8aff;
              '></div>
                                        </div>
                                        <div class="item-info">
                                                <p><b>Item Name : </b>${auction.item.name}</p>
                                                <p><b>HighestBid : </b><span id="${auction.name}highest-bid">${auction.item.highestBid?numFormatter(auction.item.highestBid.value):numFormatter(auction.item.reserve)}</span></p>
                                                <p><b>Description : </b>${String(auction.item.desc).substring(0,Math.min(40,String(auction.item.desc).length))+"..."}</p>
                                        </div>
                                </div>
                            </div>
                            </a>
                        </li>`;
                    }
                    else if(!object.isLive && object.reason==="upcoming"){
                        console.log(object);
                        htmlLive+=`
                    <li id=${auction.name} class="auction-list-item">
                        <a class="auction-link" href ="/auction/${auction.name}">
                            <div class="mycard">
                                <div class="mycard-title center">
                                    <h3 class="auction-title">${auction.name}</h3>
                                    <small class="time-remaining">${auction.startDate}</small>
                                </div>
                                <div class="mycard-body">
                                        <div class="item-image-container">
                                            <div class="item-img" style='background: url("${auction.item.imageFront}");
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                /* background-color: rgb(240, 240, 240); */
                /* box-shadow: 0 0 1rem .05rem rgba(128, 128, 128, 0.137); */
                height: 125px;
                width: 125px;
                border-radius: 10px;
                border: 2px solid #5f8aff;
              '></div>
                                        </div>
                                        <div class="item-info">
                                               <p><b>Item Name : </b>${auction.item.name}</p>
                                                <p><b>HighestBid : </b><span id="${auction.name}highest-bid">${auction.item.highestBid?numFormatter(auction.item.highestBid.value):numFormatter(auction.item.reserve)}</span></p>
                                                <p><b>Description : </b>${String(auction.item.desc).substring(0,Math.min(40,String(auction.item.desc).length))+"..."}</p>
                                          </div>
                                </div>
                            </div>
                            </a>
                        </li>`;
                    }else{
                    htmlEnd+=`
                    <li id=${auction.name} class="auction-list-item">
                        <a class="auction-link" href ="/auction/${auction.name}">
                            <div class="mycard">
                                <div class="mycard-title center">
                                    <h3 class="auction-title">${auction.name}</h3>
                                    <small class="time-remaining">${auction.startDate}</small>
                                </div>
                                <div class="mycard-body">
                                        <div class="item-image-container">
                                            <div class="item-img" style='background: url("${auction.item.imageFront}");
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                /* background-color: rgb(240, 240, 240); */
                /* box-shadow: 0 0 1rem .05rem rgba(128, 128, 128, 0.137); */
                height: 125px;
                width: 125px;
                border-radius: 10px;
                border: 2px solid #5f8aff;
              '></div>
                                        </div>
                                        <div class="item-info">
                                            <p><b>Item Name : </b>${auction.item.name}</p>
                                                <p><b>HighestBid : </b><span id="${auction.name}highest-bid">${auction.item.highestBid?numFormatter(auction.item.highestBid.value):numFormatter(auction.item.reserve)}</span></p>
                                                <p><b>Description : </b>${String(auction.item.desc).substring(0,Math.min(40,String(auction.item.desc).length))+"..."}</p>
                                        </div>
                                </div>
                            </div>
                            </a>
                        </li>`;
    

                    }
                    if(html.trim().length===0){
                        $(".live-auctions>.info").html('<div class="not-found"></div>No live auction found.');
                    }else{
                        $(".live-auctions>.auction-list").html(html);
                        $(".live-auctions>.info").html("");
                     }
                     if(htmlEnd.trim().length===0){
                        $(".finished-auctions>.info").html('<div class="not-found"></div>No Data found.');
                    }else{
                        $(".finished-auctions>.auction-list").html(htmlEnd);
                        $(".finished-auctions>.info").html("");

                    }
                    if(htmlLive.trim().length===0){
                        $(".upcoming-auctions>.info").html('<div class="not-found"></div>No upcoming auction found.');
                    }else{
                        $(".upcoming-auctions>.auction-list").html(htmlLive);
                        $(".upcoming-auctions>.info").html("");
                    }
                    console.log(auction.item.highestBid?auction.item.highestBid.value:auction.item.reserve);
                   
                   
                    
                   
                   
                    

        
            //      $("#submit").on("click",()=>{
            // var bidValue = $("#bidValue").val();
            // var highestBid = $("#highest-bid").html();
            // var auctionName = $("#auctionName").val();
            // var userData = <%-JSON.stringify(userData)%>

            // console.log(bidValue,highestBid,auctionName,userData);
            // $.ajax({
            //     url:`/placeBid/${auction.name}`,
            //     method:"POST",
            //     data:{bidValue:bidValue,highestBid:highestBid,userData:userData},
            //     success:function(result,status,xhr){
            //         if(result.message==="ok")
            //         alert("ok");
            //         else
            //         alert("not ok");
            //     },
            //     error:function(xhr,status,error){
            //         console.log(error);
            //     }
            // })
        // })
                });

                // var auctions = document.querySelectorAll(".live-auctions .auction-list-item");
                // for(var i = 0;i<auctions.length;i++){

                //     auctions[i].addEventListener('click',(e)=>{
                //         console.log(e.srcElement);
                //     })
                        
                //     console.log(auctions[i]);
     
                // } 
                
                firebase.database().ref(`auctions`).on("value",(snapshot)=>{
                    timer(snapshot)
                        snapshot.forEach(element=>{
                            $(`#${element.val().name}highest-bid`).html(numFormatter(element.val().item.highestBid.value));
                        })
                   
                 })
                
            },
            error:function(xhr,status,error){

            }
        })

        $("#search").on('change',(e)=>{
            searchPattern(e)
        })

        function searchPattern(e){
            console.log(e.target.value);
            
        }

        function openPage(pageName, elmnt) {
  // Hide all elements with class="tabcontent" by default */
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("auction");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  // Remove the background color of all tablinks/buttons
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].style.backgroundColor = "";
    tablinks[i].style.color = "rgb(139, 139, 139)";
  }

  // Show the specific tab content
//   console.log(pageName);
  document.querySelector("."+pageName).style.display = "block";

  elmnt.style.color = "blue";

}
document.getElementById("defaultOpen").click();
       

    </script>

</body>
</html>
